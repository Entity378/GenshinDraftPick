<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lobby</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <div class="room-id" id="room-id"></div>
        <button class="copy-btn" id="copy-btn">Copia ID Stanza</button>
        <div class="copy-message" id="copy-message" style="display: none;">ID copiato negli appunti!</div>

        <button id="start-btn" class="start-btn" style="display: none;">Inizia Gioco</button>

        <h2>Partecipanti</h2>
        <ul id="participants"></ul>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const roomId = window.location.pathname.split("/")[2];
        const username = new URLSearchParams(window.location.search).get("username");

        const roomIdDiv = document.getElementById("room-id");
        const copyBtn = document.getElementById("copy-btn");
        const copyMessage = document.getElementById("copy-message");
        const participantsList = document.getElementById("participants");
        const startButton = document.getElementById("start-btn");

        roomIdDiv.textContent = roomId;

        copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(roomId).then(() => {
                copyMessage.style.display = "block";
                setTimeout(() => {
                    copyMessage.style.display = "none";
                }, 2000);
            }).catch((err) => {
                console.error("Errore nella copia dell'ID:", err);
            });
        });

        socket.emit("join-room", roomId, username);

        socket.on("update-participants", (participants) => {
            participantsList.innerHTML = "";
            participants.forEach((user, index) => {
                const listItem = document.createElement("li");
                listItem.textContent = user.username;
                participantsList.appendChild(listItem);

                if (index === 0 && user.username === username) {
                    startButton.style.display = "block";
                }
            });
        });

        startButton.addEventListener("click", () => {
            socket.emit("start-game", roomId);
        });

        socket.on("redirect-to-game", () => {
            window.location.href = `/game/${roomId}?username=${username}`;
        });

        socket.on("user-disconnected", (username) => {
            console.log(username + " si Ã¨ disconnesso");
        });
    </script>
</body>
</html>
